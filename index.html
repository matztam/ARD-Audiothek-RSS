<!DOCTYPE html>
<html>
  <head>
    <style>
        /* thanks to https://perfectmotherfuckingwebsite.com */
    body {
        max-width: 650px;
        margin: 40px auto;
        padding: 0 10px;
        font: 18px/1.5 -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
        color: #444
    }

    @media (prefers-color-scheme: dark) {
        body {
            color: #c9d1d9;
            background: #0d1117
        }

        a:link {
            color: #58a6ff
        }

        a:visited {
            color: #8e96f0
        }

        input {
            background: #282f3b;
            border: none;
        }

        input, select, textarea{
            color: #c9d1d9;
        }
        
    }
    </style>
    <title>Using the Audiothek RSS Feed Generator</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <!-- weitere Kopfinformationen -->
    <!-- Kommentare werden im Browser nicht angezeigt. -->
  </head>
  <body>
    <h1>Instructions</h1>
    <p>This page can generate an RSS feed from ARD Audiothek data. Follow these steps:</p>
    <ul>
        <li>Find the ID of the desired podcast. This is a sequence of digits at the end of the podcast’s URL in the Audiothek. For example, 94702896 for the podcast <a href="https://www.ardaudiothek.de/sendung/wild-wild-web-geschichten-aus-dem-internet/94702896/">Wild Wild Web</a>.</li>
        <li>Open the following link and insert the ID after the =: <a href="./ardaudiothek-rss.php?show=">ardaudiothek-rss</a>.</li>
        <li>For example, the resulting link is: <a href="./ardaudiothek-rss.php?show=94702896">Example Wild Wild Web</a>.</li>
    </ul>
    <p>If you only want to subscribe to the last X episodes, append “&amp;latest=X”: <a href="./ardaudiothek-rss.php?show=94702896&latest=10">Example Wild Wild Web, last 10 episodes</a>.
    </br></br>
<!--
    <h2>Feed-ID Bestimmen</h2>
    <p>Im folgenden Feld kann die URL aus der ARD Audiothek direkt eingefügt werden, um die ID zu extrahieren.</p>

    <input type="ArdLink" id="ArdLink" alt="URL des Podcasts in der ARD Audiothek" />
    <input type="button" id="calcIDBtn" value="Feed-ID extrahieren" onclick="javascript:" />
-->

    <h2>Open Feed</h2>
    <p>Enter the desired feed ID in the field below, then click “Open Feed”.</p>
    <input type="FeedID" id="FeedID" alt="Feed ID"/>
    <input type="button" id="openFeed" value="Open Feed" onClick="javascript: window.open('./ardaudiothek-rss.php?show=' + document.getElementById('FeedID').value);" />

<!-- noch einen Button einbauen, der den Link unten drunter anzeigt und potentiell in die Zwischenablage kopiert? -->

<!-- Podcast-Suche -->
<h2>Search Podcasts</h2>
<p>Search for a podcast. Click a suggestion to use its ID.</p>
<input type="text" id="searchQuery" placeholder="Search term..." />
<input type="button" id="searchBtn" value="Search" />
<ul id="searchResults" style="list-style-type:none; padding-left:0;"></ul>
<script>
async function searchPodcasts() {
    const query = document.getElementById('searchQuery').value.trim();
    const resultsList = document.getElementById('searchResults');
    resultsList.innerHTML = '';
    if (!query) return;
    resultsList.innerHTML = '<li>Searching...</li>';
    try {
        const response = await fetch(`https://api.ardaudiothek.de/search?query=${encodeURIComponent(query)}`);
        const data = await response.json();
        const nodes = (data.data && data.data.search && data.data.search.programSets && data.data.search.programSets.nodes) || [];
        if (nodes.length === 0) {
            resultsList.innerHTML = '<li>No podcasts found.</li>';
            return;
        }
        resultsList.innerHTML = '';
        nodes.forEach(podcast => {
            const li = document.createElement('li');
            li.style.cursor = 'pointer';
            li.style.marginBottom = '12px';
            li.style.display = 'flex';
            li.style.alignItems = 'center';
            li.style.padding = '6px 0';
            li.style.borderBottom = '1px solid #eee';
            
            // Thumbnail
            if (podcast.image && podcast.image.url1X1) {
                const img = document.createElement('img');
                img.src = podcast.image.url1X1.replace('{width}', '48');
                img.alt = podcast.title;
                img.style.width = '48px';
                img.style.height = '48px';
                img.style.objectFit = 'cover';
                img.style.borderRadius = '8px';
                img.style.marginRight = '12px';
                li.appendChild(img);
            }
            // Text
            const textDiv = document.createElement('div');
            textDiv.innerHTML = `<strong>${podcast.title}</strong><br><span style='font-size:13px;color:#888;'>ID: ${podcast.id}</span>`;
            if (podcast.synopsis) {
                textDiv.title = podcast.synopsis;
            }
            li.appendChild(textDiv);
            li.onclick = () => {
                document.getElementById('FeedID').value = podcast.id;
                resultsList.innerHTML = '';
            };
            resultsList.appendChild(li);
        });
    } catch (e) {
        resultsList.innerHTML = '<li>Error during search.</li>';
    }
}
document.getElementById('searchBtn').onclick = searchPodcasts;
document.getElementById('searchQuery').addEventListener('keydown', function(e) {
    if (e.key === 'Enter') searchPodcasts();
});
</script>

  </body>
</html>
